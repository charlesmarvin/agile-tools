<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Agile Tools</title>
  <meta name="description" content="Agile Tools - A Train Hacking Production">
  <meta name="author" content="Marvin Charles">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" type="text/css" href="/css/lib/normalize.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css">

  <!-- JavaScript - Preload
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="modulepreload" href="/js/app.module.js">
  <link rel="modulepreload" href="/js/fibonacci-board.module.js">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

</head>

<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container" id="app">
    
    <div class="flex-grid">
      <div class="col">
        <h1 v-bind:title="appName" class="home">
          <a href="/">{{ appHomeText }}</a>
        </h1>
      </div>
      <div class="flex-grid">
          <app-alerts></app-alerts> 
      </div>
    </div>

    <div class="flex-grid">
      <div class="col">
        <create-board-form></create-board-form>
      </div>
    </div>

    <div class="flex-grid">
      <div class="col">
          <board></board>
      </div>
    </div>
  </div>

  <!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  Vue.component('app-alerts', {
    created: function () {
      const vm = this
      this.$root.$on('alert-success', (msg) => vm.showAlert('success', msg))
      this.$root.$on('alert-info', (msg) => vm.showAlert('info', msg))
      this.$root.$on('alert-warn', (msg) => vm.showAlert('warn', msg))
      this.$root.$on('alert-error', (msg) => vm.showAlert('error', msg))
    },
    data: function() {
      return {
        alertClass: '',
        message: '',
        show: false
      }
    },
    methods: {
      close: function() {
        this.show = false
      },
      showAlert: function (type, message) {
        const vm = this
        this.alertClass = `alert-${type}`
        this.message = message
        this.show = true
        setTimeout(() => vm.show = false, 5000)
      }
    },
    template: `
      <div 
        class="alert alert-dismissible" 
        role="alert"
        v-bind:class="[alertClass]"
        v-if="show"
      >
        {{ message }}
        <button 
          aria-label="Close" 
          type="button" 
          class="close" 
          data-dismiss="alert" 
          v-on:click="close"
          >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    `
  })

  Vue.component('board', {
    created: function () {
      const vm = this
      this.$root.$on('show-board', (boardId) => vm.loadBoard(boardId))
      vm.loadBoard(window.location.hash)
      
    },
    data: function() {
      return {
        activeBoard: null
      }
    },
    methods: {
      loadBoard: function (boardId) {
        console.log('Attempting to load board: ', boardId)
        if (!boardId) return
        const vm = this
        fetch('/api/v1/boards/' + boardId.substr(1), {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        }).then(res => res.json())
          .then(response => vm.activeBoard = response)
          .catch(error => this.$root.$emit('alert-error', 'Oh snap. We had some issues loading that board.'))
      }
    },
    template: `<div v-if="activeBoard">{{activeBoard}}</div>`
  })
  Vue.component('card', {
    data: function() {
      return {
        reveal: false,
        text: ''
      }
    },
    template: `
      <div>
        <button>{{text}}</button>
      </div>
      `
  })
  Vue.component('create-board-form', {
    data: function() {
      return {
        boardName: '',
        boardType: 'standard',
        passcode: '',
        show: !window.location.hash,
        showPasscode: false
      }
    },
    methods: {
      createBoard: function (event) {
        var vm = this
        var payload = {
          name: this.boardName,
          type: this.boardType,
          passcode: this.passcode
        }
        console.log('creating board ', payload)
        if (!payload.name || !payload.type) {
          vm.$root.$emit('alert-error', 'Name and type are required.')
          return
        }
        fetch('/api/v1/boards', {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: {
            'Content-Type': 'application/json'
          }
        }).then(res => res.json())
          .then(response => {
            window.location.hash = response.id
            vm.show = false
            vm.$root.$emit('alert-success', 'Cool. Your board was created.')
            vm.$root.$emit('show-board', response.id)
          })
          .catch(error => vm.$root.$emit('alert-error', 'Well that\'s embarrassing. Looks like we messed up creating your board.'))
      },
      toggleSecure: function () {
        this.showPasscode = !this.showPasscode
      }
    },
    template: `
      <form id="create-board-form" v-if="show">
          <div class="flex-grid-sp thirds">
            <label class="col board-type-select">
              <input type="radio" name="boardType" v-model="boardType" value="standard">
              <span>Standard</span>
            </label>
            <label class="col board-type-select">
              <input type="radio" name="boardType" v-model="boardType" value="fibonacci">
              <span>Fibonacci</span>
            </label>
            <label class="col board-type-select">
              <input type="radio" name="boardType" v-model="boardType" value="tshirt">
              <span>T-Shirt</span>
            </label>
          </div>
          
          <div class="flex-grid">
            <div class="col">
              <input v-model="boardName" type="text" name="boardName" placeholder="Sprint 23" id="board-name-input">
            </div>
          </div>
          
          <div>
            <div class="flex-grid toggle">
              <label class="col" v-if="showPasscode" v-on:click="toggleSecure">
                <span class="icon svg-baseline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M7,11 L7,6 C7,3.23857625 9.23857625,1 12,1 C14.7614237,1 17,3.23857625 17,6 L17,8 L15,8 L15,6 C15,4.34314575 13.6568542,3 12,3 C10.3431458,3 9,4.34314575 9,6 L9,11 L18,11 C19.1045695,11 20,11.8954305 20,13 L20,21 C20,22.1045695 19.1045695,23 18,23 L6,23 C4.8954305,23 4,22.1045695 4,21 L4,13 C4,11.8954305 4.8954305,11 6,11 L7,11 Z M6,13 L6,21 L18,21 L18,13 L6,13 Z M12,18 C11.4477153,18 11,17.5522847 11,17 C11,16.4477153 11.4477153,16 12,16 C12.5522847,16 13,16.4477153 13,17 C13,17.5522847 12.5522847,18 12,18 Z"/>
                  </svg>
                </span>
                Make Public
              </label>
              <label class="col" v-else v-on:click="toggleSecure">
                <span class="icon svg-baseline">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M7,10 L7,7 C7,4.23857625 9.23857625,2 12,2 C14.7614237,2 17,4.23857625 17,7 L17,10 L18,10 C19.0683513,10 20,10.7763739 20,11.8333333 L20,20.1666667 C20,21.2236261 19.0683513,22 18,22 L6,22 C4.93164867,22 4,21.2236261 4,20.1666667 L4,11.8333333 C4,10.7763739 4.93164867,10 6,10 L7,10 Z M9,10 L15,10 L15,7 C15,5.34314575 13.6568542,4 12,4 C10.3431458,4 9,5.34314575 9,7 L9,10 Z M6,12 L6,20 L18,20 L18,12 L6,12 Z M12,17 C11.4477153,17 11,16.5522847 11,16 C11,15.4477153 11.4477153,15 12,15 C12.5522847,15 13,15.4477153 13,16 C13,16.5522847 12.5522847,17 12,17 Z"/>
                  </svg>
                </span>
                Password Protect
              </label>
            </div>
          </div>
          
          <div class="flex-grid" v-if="showPasscode">
            <div class="col">
              <input v-model="passcode" type="text" name="passcode" placeholder="Passcode" id="board-passcode-input">
            </div>
          </div>

          <div class="flex-grid">
            <div class="col">
              <button @click.prevent="createBoard" class="button-primary" type="submit">Create Board</button>
            </div>
          </div>
        </div>
      </form>
    `
  })
  var app = new Vue({
  el: '#app',
  data: {
    appName: 'Agile Tools',
    appHomeText: 'A-T'
  },
  methods: {
  }
})
</script>
</html>